<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø£Ø±Ø¨Ø§Ø­ FC 26 (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© - Ù…ÙØµÙ„Ø­Ø©)</title>
    <style>
        /* 1. ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† (Dark Theme) */
        :root {
            --bg-color: #121212; 
            --card-color: #1e1e1e; 
            --text-color: #e0e0e0; 
            --input-bg: #2e2e2e; 
            --border-color: #444;
            --profit-color: #66BB6A; /* Ø£Ø®Ø¶Ø± */
            --loss-color: #EF5350;   /* Ø£Ø­Ù…Ø± */
            --update-color: #FFC107; /* Ø£ØµÙØ± */
            --delete-color: #dc3545;
            --edit-color: #17a2b8;
            --total-color: #007bff; /* Ø£Ø²Ø±Ù‚ Ù„Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ */
            --buy-color: #ff9800; /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ù„Ù„Ø´Ø±Ø§Ø¡ */
            --sell-color: #2196F3; /* Ø£Ø²Ø±Ù‚ Ù„Ù„Ø¨ÙŠØ¹ */
            --pdf-button-color: #dc3545; /* Ø£Ø­Ù…Ø± Ù„Ù„ØªØµØ¯ÙŠØ± */
            --reset-button-color: #6c757d; /* Ø±Ù…Ø§Ø¯ÙŠ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† */
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 40px 20px;
            margin: 0;
            direction: rtl; 
        }

        #main-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            width: 100%;
            max-width: 900px;
        }

        .calculator {
            background-color: var(--card-color);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            width: 100%;
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± (Ù…Ø®ØªØµØ±Ø©) */
        input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-sizing: border-box; 
            text-align: right;
            background-color: var(--input-bg);
            color: var(--text-color);
        }

        button {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            margin-top: 10px;
            font-size: 0.9em;
        }

        #actionButton {
            background-color: var(--profit-color);
            color: var(--card-color);
            width: 100%;
            font-size: 1em;
            margin-bottom: 5px;
        }

        #actionButton.updating {
            background-color: var(--update-color);
            color: #2c2c2c;
        }
        
        #exportPdfButton {
            background-color: var(--pdf-button-color);
            color: white;
            width: 100%;
            font-size: 1em;
            margin-top: 15px;
        }
        
        #resetAllDealsButton {
            background-color: var(--reset-button-color);
            color: white;
            width: 100%;
            font-size: 0.9em;
            margin-top: 20px;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ù‚Ø³Ù… Ø§Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ù…Ù„ */
        .summary-box {
            background-color: #242424; 
            padding: 20px;
            margin-top: 20px;
            border-radius: 8px;
            border-top: 3px solid var(--total-color);
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dotted #3a3a3a;
        }
        .summary-value {
            font-weight: bold;
        }
        
        .profit { color: var(--profit-color); }
        .loss { color: var(--loss-color); }

        /* ØªÙ†Ø³ÙŠÙ‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙÙ‚Ø§Øª */
        .saved-deals-container {
            background-color: var(--card-color);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            width: 100%;
        }

        .deal-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: #242424;
        }
        
        /* --------------------------------- */
        /* 2. ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© (Ù„Ù€ PDF) */
        /* --------------------------------- */
        @media print {
            /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± ØºÙŠØ± Ø§Ù„Ù…Ø±ØºÙˆØ¨ ÙÙŠÙ‡Ø§ ÙÙŠ PDF */
            .calculator, #noDealsMessage, .deal-actions, #exportPdfButton, #cancelEditButton, #actionButton, #resetAllDealsButton {
                display: none !important;
            }

            /* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø®Ù„ÙÙŠØ§Øª ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù† Ù„Ù€ PDF */
            body, #main-container, .saved-deals-container {
                background-color: white !important;
                color: #333 !important; 
                box-shadow: none !important;
                padding: 0 !important;
                margin: 0 auto !important;
            }
            .profit { color: green !important; }
            .loss { color: red !important; }
            .summary-value.buy { color: #ff8c00 !important; }
            .summary-value.sell { color: #007bff !important; }
            .deal-item, .summary-box {
                background-color: #f9f9f9 !important;
                border: 1px solid #ddd !important;
                -webkit-print-color-adjust: exact; 
                color-adjust: exact;
            }
        }
    </style>
</head>
<body>

<div id="main-container">
    <div class="calculator">
        <h2>ğŸ’° Ø­Ø§Ø³Ø¨Ø© Ø£Ø±Ø¨Ø§Ø­ Ø¨ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (FC 26)</h2>

        <div>
            <label for="dealName">Ø§Ø³Ù… Ø§Ù„ØµÙÙ‚Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
            <input type="text" id="dealName" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø¨Ø§Ø¯Ù„Ø© ØµÙ„Ø§Ø­">
        </div>

        <div>
            <label for="sellPrice">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ÙˆØ§Ø­Ø¯ (ÙƒÙˆÙŠÙ†Ø²):</label>
            <input type="number" id="sellPrice" oninput="calculateProfit()" placeholder="Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹..." min="0" step="100">
        </div>

        <div>
            <label for="buyPrice">Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ÙˆØ§Ø­Ø¯ (ÙƒÙˆÙŠÙ†Ø²):</label>
            <input type="number" id="buyPrice" oninput="calculateProfit()" placeholder="Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡..." min="0" step="100">
        </div>
        
        <div>
            <label for="quantity">Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¨Ø§Ø¹ÙŠÙ†:</label>
            <input type="number" id="quantity" oninput="calculateProfit()" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø¯Ø¯..." min="1" step="1">
        </div>

        <div class="result" id="results">
            <p><strong>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</strong> <span id="netRevenue">0</span> ÙƒÙˆÙŠÙ†Ø²</p>
            <p><strong>Ø§Ù„Ø±Ø¨Ø­ / Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„ØµØ§ÙÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:</strong> <span id="netProfit" class="profit">0</span> ÙƒÙˆÙŠÙ†Ø²</p>
        </div>
        
        <button id="actionButton" class="saving" onclick="handleAction()">Ø­ÙØ¸ Ø§Ù„ØµÙÙ‚Ø©</button>
        <button id="cancelEditButton" onclick="cancelEdit()">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø­ÙØ¸</button>
    </div>

    <div class="saved-deals-container">
        <h2>ğŸ“‚ Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h2>
        <ul id="savedDealsList">
            </ul>
        <p id="noDealsMessage" style="text-align: center; color: #888;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙÙ‚Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯.</p>

        <div id="summaryBox" class="summary-box" style="display: none;">
            <h3>ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</h3>
            <div class="summary-item">
                <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (Ø§Ù„ØªÙƒÙ„ÙØ©):</span>
                <span id="totalBuy" class="summary-value buy">0 ÙƒÙˆÙŠÙ†Ø²</span>
            </div>
             <div class="summary-item">
                <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ (Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø§Ù…):</span>
                <span id="totalSell" class="summary-value sell">0 ÙƒÙˆÙŠÙ†Ø²</span>
            </div>
            <div class="summary-item">
                <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø¨Ø¹Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (5%):</span>
                <span id="totalNetRevenue" class="summary-value sell">0 ÙƒÙˆÙŠÙ†Ø²</span>
            </div>
            <div class="summary-item">
                <span>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ / Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                <span id="totalProfitValue" class="summary-value profit">0 ÙƒÙˆÙŠÙ†Ø²</span>
            </div>
        </div>
        
        <button id="exportPdfButton" onclick="exportToPdf()">ğŸ“¥ ØªØµØ¯ÙŠØ± ÙƒÙ…Ù„Ù PDF Ù…Ù„ÙˆÙ†</button>
        <button id="resetAllDealsButton" onclick="resetAllDeals()">âš ï¸ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙˆØ­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙ‚Ø§Øª</button>
    </div>
</div>

<script>
    const STORAGE_KEY = 'fc26_saved_deals';
    const TAX_RATE = 0.05;
    let editingDealId = null;

    // ------------------------------------
    // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©: Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙ‚Ø§Øª
    // ------------------------------------
    window.resetAllDeals = function() {
        if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©ØŸ Ù„Ù† ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡Ø§.')) {
            localStorage.removeItem(STORAGE_KEY);
            editingDealId = null;
            clearInputFields();
            renderDealsList();
            alert('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙ‚Ø§Øª Ø¨Ù†Ø¬Ø§Ø­. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø­ÙØ¸ ØµÙÙ‚Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.');
        }
    }
    
    // ------------------------------------
    // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ (ÙƒÙ…Ø§ Ù‡ÙŠ)
    // ------------------------------------
    window.exportToPdf = function() {
        window.print();
    }

    function formatNumber(num) {
        if (isNaN(num) || num === null) return '0';
        return Math.round(num).toLocaleString('en-US');
    }

    function calculateProfit() {
        const sellPrice = parseFloat(document.getElementById('sellPrice').value) || 0;
        const buyPrice = parseFloat(document.getElementById('buyPrice').value) || 0;
        const quantity = parseInt(document.getElementById('quantity').value) || 1; 

        const totalSellPrice = sellPrice * quantity;
        const totalBuyPrice = buyPrice * quantity;
        const totalTax = totalSellPrice * TAX_RATE;
        const totalNetRevenue = totalSellPrice - totalTax;
        const totalNetProfit = totalNetRevenue - totalBuyPrice;

        document.getElementById('netRevenue').textContent = formatNumber(totalNetRevenue);
        
        const netProfitElement = document.getElementById('netProfit');
        netProfitElement.textContent = formatNumber(totalNetProfit);

        if (totalNetProfit > 0) {
            netProfitElement.className = 'deal-profit profit';
        } else if (totalNetProfit < 0) {
            netProfitElement.className = 'deal-profit loss';
        } else {
            netProfitElement.className = 'deal-profit'; 
        }

        return { totalNetProfit, sellPrice, buyPrice, quantity, totalSellPrice, totalBuyPrice, totalNetRevenue };
    }

    function getDealsFromStorage() {
        const storedDeals = localStorage.getItem(STORAGE_KEY);
        try {
            return storedDeals ? JSON.parse(storedDeals) : [];
        } catch (e) {
            console.error("Local Storage data corrupted, clearing saved deals.", e);
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ§Ù„ÙØ©ØŒ Ù‚Ù… Ø¨Ø­Ø°ÙÙ‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
            localStorage.removeItem(STORAGE_KEY); 
            return [];
        }
    }
    
    function handleAction() {
        if (editingDealId) {
            updateDeal(editingDealId);
        } else {
            saveDeal();
        }
    }
    
    function saveDeal() {
        const { totalNetProfit, sellPrice, buyPrice, quantity, totalSellPrice, totalBuyPrice, totalNetRevenue } = calculateProfit();
        let dealName = document.getElementById('dealName').value.trim() || `ØµÙÙ‚Ø© ØºÙŠØ± Ù…ÙØ³Ù…Ø§Ø© (${new Date().toLocaleTimeString('ar-EG')})`;
        
        if (sellPrice <= 0) {
            alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± Ø¨ÙŠØ¹ ØµØ­ÙŠØ­ Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ± Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸.");
            return;
        }
        
        const newDeal = {
            id: Date.now(),
            name: dealName,
            sell: sellPrice,
            buy: buyPrice,
            qty: quantity,
            profit: totalNetProfit,
            totalSell: totalSellPrice, 
            totalBuy: totalBuyPrice,   
            totalNetRevenue: totalNetRevenue 
        };

        const deals = getDealsFromStorage();
        deals.push(newDeal);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(deals));
        
        clearInputFields();
        renderDealsList();
    }
    
    window.updateDeal = function(idToUpdate) {
        const { totalNetProfit, sellPrice, buyPrice, quantity, totalSellPrice, totalBuyPrice, totalNetRevenue } = calculateProfit();
        let dealName = document.getElementById('dealName').value.trim() || `ØµÙÙ‚Ø© Ù…ÙØ¹Ø¯Ù„Ø© (${new Date().toLocaleTimeString('ar-EG')})`;

        if (sellPrice <= 0) {
            alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± Ø¨ÙŠØ¹ ØµØ­ÙŠØ­ Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ± Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«.");
            return;
        }

        let deals = getDealsFromStorage();
        const index = deals.findIndex(deal => deal.id === idToUpdate);

        if (index !== -1) {
            deals[index] = {
                id: idToUpdate,
                name: dealName,
                sell: sellPrice,
                buy: buyPrice,
                qty: quantity,
                profit: totalNetProfit,
                totalSell: totalSellPrice,
                totalBuy: totalBuyPrice,
                totalNetRevenue: totalNetRevenue
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(deals));
            
            cancelEdit(); 
            renderDealsList();
        } else {
            alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙÙ‚Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ«.");
        }
    }

    window.editDeal = function(dealId) {
        const deals = getDealsFromStorage();
        const dealToEdit = deals.find(deal => deal.id === dealId);

        if (dealToEdit) {
            document.getElementById('dealName').value = dealToEdit.name;
            document.getElementById('sellPrice').value = dealToEdit.sell;
            document.getElementById('buyPrice').value = dealToEdit.buy;
            document.getElementById('quantity').value = dealToEdit.qty;

            calculateProfit();

            editingDealId = dealId;
            const actionButton = document.getElementById('actionButton');
            actionButton.textContent = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙÙ‚Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©';
            actionButton.classList.remove('saving');
            actionButton.classList.add('updating');
            
            document.getElementById('cancelEditButton').style.display = 'block';
        }
    }

    window.cancelEdit = function() {
        editingDealId = null;
        const actionButton = document.getElementById('actionButton');
        actionButton.textContent = 'Ø­ÙØ¸ Ø§Ù„ØµÙÙ‚Ø©';
        actionButton.classList.remove('updating');
        actionButton.classList.add('saving');
        
        document.getElementById('cancelEditButton').style.display = 'none';
        clearInputFields();
    }
    
    function clearInputFields() {
        document.getElementById('dealName').value = '';
        document.getElementById('sellPrice').value = '';
        document.getElementById('buyPrice').value = '';
        document.getElementById('quantity').value = '1';
        calculateProfit();
    }

    function renderDealsList() {
        const deals = getDealsFromStorage();
        const list = document.getElementById('savedDealsList');
        const message = document.getElementById('noDealsMessage');
        const summaryBox = document.getElementById('summaryBox');

        list.innerHTML = '';
        
        let totalProfit = 0;
        let grandTotalBuy = 0;
        let grandTotalSell = 0;
        let grandTotalNetRevenue = 0;

        if (deals.length === 0) {
            message.style.display = 'block';
            summaryBox.style.display = 'none';
        } else {
            message.style.display = 'none';
            summaryBox.style.display = 'block';
        }

        deals.forEach(deal => {
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©/Ø§Ù„Ù…ØªØ¶Ø±Ø±Ø©
            if (deal.totalSell === undefined || deal.totalBuy === undefined || deal.profit === undefined) {
                const sellPrice = parseFloat(deal.sell) || 0;
                const buyPrice = parseFloat(deal.buy) || 0;
                const quantity = parseInt(deal.qty) || 1;
                
                deal.totalSell = sellPrice * quantity;
                deal.totalBuy = buyPrice * quantity;
                deal.totalNetRevenue = deal.totalSell * (1 - TAX_RATE);
                deal.profit = deal.totalNetRevenue - deal.totalBuy;
            }
            
            const profitValue = deal.profit;
            
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
            totalProfit += profitValue; 
            grandTotalBuy += deal.totalBuy; 
            grandTotalSell += deal.totalSell;
            grandTotalNetRevenue += deal.totalNetRevenue;

            const listItem = document.createElement('li');
            listItem.className = 'deal-item';
            
            const profitClass = profitValue > 0 ? 'profit' : (profitValue < 0 ? 'loss' : '');
            const profitSign = Math.sign(profitValue) >= 0 ? '+' : ''; 

            listItem.innerHTML = `
                <div class="deal-info">
                    <strong>${deal.name}</strong>
                    <p>
                        Ø¨ÙŠØ¹: ${formatNumber(deal.sell)} | Ø´Ø±Ø§Ø¡: ${formatNumber(deal.buy)} | Ø¹Ø¯Ø¯: ${formatNumber(deal.qty)}
                    </p>
                </div>
                <span class="deal-profit ${profitClass}">
                    ${profitSign}${formatNumber(profitValue)} ÙƒÙˆÙŠÙ†Ø²
                </span>
                <div class="deal-actions">
                    <button class="edit-btn" onclick="editDeal(${deal.id})">ØªØ¹Ø¯ÙŠÙ„</button>
                    <button class="delete-btn" onclick="deleteDeal(${deal.id})">Ø­Ø°Ù</button>
                </div>
            `;
            list.appendChild(listItem);
        });

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
        document.getElementById('totalBuy').textContent = `${formatNumber(grandTotalBuy)} ÙƒÙˆÙŠÙ†Ø²`;
        document.getElementById('totalSell').textContent = `${formatNumber(grandTotalSell)} ÙƒÙˆÙŠÙ†Ø²`;
        document.getElementById('totalNetRevenue').textContent = `${formatNumber(grandTotalNetRevenue)} ÙƒÙˆÙŠÙ†Ø²`;

        const totalProfitValueElement = document.getElementById('totalProfitValue');
        const totalClass = totalProfit > 0 ? 'profit' : (totalProfit < 0 ? 'loss' : '');
        const totalSign = Math.sign(totalProfit) >= 0 ? '+' : ''; 
        
        totalProfitValueElement.textContent = `${totalSign}${formatNumber(totalProfit)} ÙƒÙˆÙŠÙ†Ø²`;
        totalProfitValueElement.className = `summary-value ${totalClass}`;
    }

    window.deleteDeal = function(dealId) {
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØµÙÙ‚Ø©ØŸ')) {
            return;
        }
        
        let deals = getDealsFromStorage();
        deals = deals.filter(deal => deal.id !== dealId);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(deals));
        renderDealsList();
        
        if (editingDealId === dealId) {
            cancelEdit();
        }
    }

    window.onload = () => {
        calculateProfit();
        renderDealsList();
    };
</script>

</body>
</html>
